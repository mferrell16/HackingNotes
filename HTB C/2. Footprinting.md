
## Infrastructure Based Enumeration 
- crt.sh 
- curl 
```shell-session
curl -s http://example.com | jq . 

curl -s https://crt.sh/\?q\=inlanefreight.com\&output\=json | jq . | grep name | cut -d":" -f2 | grep -v "CN=" | cut -d'"' -f2 | awk '{gsub(/\\n/,"\n");}1;' | sort -u
```
- Shodan 
- dig any host 
- domain.glass 
- GrayHatWarfare 
- Google dorks 
	- intext:company inurl:amazonaws.com
	- intext:company inurl:blob.core.windows.net 
- Linkedin, Github 


## FTP 

Enumeration commands 
- status, debug, trace 
Recursive list (ls -R) 

```shell-session
get Important\ Notes.txt

wget -m --no-passive ftp://anonymous:anonymous@10.129.14.136

tree . 

put upload.txt 

```

Nmap command for ftp 
```shell-session
sudo nmap -sV -p21 -sC -A 10.129.14.136
```

## SMB 
```shell-session
smbclient -N -L //10.129.14.128 (connect without password and list) 
smbclient //IP/Share
get file.txt
ls 
cat file.txt
cd folder

```

Nmap for SMB 
```shell-session
sudo nmap 10.129.14.128 -sV -sC -p139,445
```

RPCclient (smb)
```shell-session
rpcclient -U "" 10.129.14.128
```
![[Screenshot 2025-03-13 at 11.02.50 PM.png]]

Brute Force RIDs 
```shell-session
for i in $(seq 500 1100);do rpcclient -N -U "" 10.129.14.128 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";done
```

Impacket Samrdump.py also does this 
```shell-session
samrdump.py 10.129.14.128
```

Other ways to gather SMB information 
```shell-session
smbmap -H 10.129.14.128
crackmapexec smb 10.129.14.128 --shares -u '' -p ''
```

Enum4linux 
```shell-session
mky527@htb[/htb]$ git clone https://github.com/cddmp/enum4linux-ng.git
mky527@htb[/htb]$ cd enum4linux-ng
mky527@htb[/htb]$ pip3 install -r requirements.txt

./enum4linux-ng.py 10.129.14.128 -A
```

NFS (Network File Share)


Sharing a folder with an entire subnet via NFS
```shell-session
root@nfs:~# echo '/mnt/nfs  10.129.14.0/24(sync,no_subtree_check)' >> /etc/exports
root@nfs:~# systemctl restart nfs-kernel-server 
root@nfs:~# exportfs

/mnt/nfs      	10.129.14.0/24
```

NFS nmap scan 
```shell-session
sudo nmap 10.129.14.128 -p111,2049 -sV -sC

sudo nmap --script nfs* 10.129.14.128 -sV -p111,2049
``` 
nfs-ls script is very helpful 

Once we have discovered such an NFS service, we can mount it on our local machine. For this, we can create a new empty folder to which the NFS share will be mounted. Once mounted, we can navigate it and view the contents just like our local system.

Show NFS shares available (FIRST STEP)
```shell-session
showmount -e 10.129.14.128
```

Mount NFS shares
```shell-session
mky527@htb[/htb]$ mkdir target-NFS
mky527@htb[/htb]$ sudo mount -t nfs 10.129.14.128:/ ./target-NFS/ -o nolock
mky527@htb[/htb]$ cd target-NFS
mky527@htb[/htb]$ tree .
```

Unmount NFS Shares 
```shell-session
mky527@htb[/htb]$ cd ..
mky527@htb[/htb]$ sudo umount ./target-NFS
```

NFS Lab steps
```
showmount -e IP 
mkdir target-NFS
sudo mount -t nfs 10.129.13.145:/ ./target-NFS/ -o nolock
cd target-NFS
```

## DNS 

![[Screenshot 2025-03-13 at 11.41.39 PM.png]]

Dig commands for records 
```shell-session
dig soa www.inlanefreight.com

dig any inlanefreight.htb @10.129.14.128

```
Discover nameservers 
```shell-session
dig ns inlanefreight.htb @10.129.14.128
```
Zone Transfer 
```shell-session
dig axfr inlanefreight.htb @10.129.14.128
```

Subdomain bruteforcing 
```shell-session
for sub in $(cat /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt);do dig $sub.inlanefreight.htb @10.129.14.128 | grep -v ';\|SOA' | sed -r '/^\s*$/d' | grep $sub | tee -a subdomains.txt;done
```
Using dnsenum for subdomains
```shell-session
dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt inlanefreight.htb
```

Challenge 
```
dig inlanefreight.htb @10.129.151.57
dig axfr inlanefreight.htb @10.129.151.57

Find subdomains then zone trasnfer each one 
dig axfr internal.inlanefreight.htb @10.129.151.57

dnsenum --dnsserver 10.129.14.128 --enum -p 0 -s 0 -o subdomains.txt -f /opt/useful/seclists/Discovery/DNS/subdomains-top1million-110000.txt dev.inlanefreight.htb
```


SMTP 

![[Screenshot 2025-03-14 at 12.12.32 AM.png]]

Connect to smtp server
```shell-session
telnet 10.129.14.128 25
```
nmap 
```shell-session
sudo nmap 10.129.14.128 -sC -sV -p25

sudo nmap 10.129.14.128 -p25 --script smtp-open-relay -v

``` 

Enumerate users 
```
smtp-user-enum -w 15 -U users.txt -t 10.129.151.57
```

## IMAP/POP3

IMAP allows online management of emails directly on the server and supports folder structures.

Nmap
```shell-session
sudo nmap 10.129.14.128 -sV -p110,143,993,995 -sC
```
Connecting 
```shell-session
curl -k 'imaps://10.129.14.128' --user cry0l1t3:1234 -v
```

Connecting with openssl
```
openssl s_client -connect 10.129.14.128:pop3s
openssl s_client -connect 10.129.14.128:imaps
```

IMAP Commands
![[Screenshot 2025-03-15 at 11.45.08 PM.png]]

POP3 commands 
![[Screenshot 2025-03-15 at 11.45.35 PM.png]]

Challenge 
```
openssl s_client -connect 10.129.14.128:pop3s {version is bottom lien}
openssl s_client -connect 10.129.14.128:imaps
a login robin robin
1 LIST "" *
1 SELECT DEV.DEPARMTENT.INT
1 FETCH 1 all     {this gets the metadata of the first email}
1 FETCH 1 BODY[TEXT] {This gets the entire message}
```

## SMTP 

Version 2 smpwalk 
```shell-session
snmpwalk -v2c -c public 10.129.14.128
```

Brute force community string 
```shell-session
sudo apt install onesixtyone
onesixtyone -c /opt/useful/seclists/Discovery/SNMP/snmp.txt 10.129.14.128
``` 

brute-force OIDs and enumerate 
```shell-session
mky527@htb[/htb]$ sudo apt install braa
mky527@htb[/htb]$ braa <community string>@<IP>:.1.3.6.*   # Syntax
mky527@htb[/htb]$ braa public@10.129.14.128:.1.3.6.*
```

## MySQL 

nmap command
```shell-session
sudo nmap 10.129.14.128 -sV -sC -p3306 --script mysql*
```

Connecting to a mysql server
```shell-session
mysql -u root -h 10.129.14.132
mysql -u robin -ppassword -h IP 
```

SQL commands 
```
show databases;
select version(); 
use db1;
show tables; 
select * from table1; 
```

## MSSQL 

```shell-session
locate mssqlclient
``` 

![[Screenshot 2025-03-18 at 5.25.33 PM.png]]

Nmap command 
```shell-session
sudo nmap --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes --script-args mssql.instance-port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER -sV -p 1433 10.129.201.248
```

Metasploit Module for footprinting 
```shell-session
msf6 auxiliary(scanner/mssql/mssql_ping)
```

Connect via Impacket 
```shell-session
python3 mssqlclient.py Administrator@10.129.201.248 -windows-auth
```

Lab answers 
```sql
select name from sys.databases
SELECT Distinct TABLE_NAME FROM information_schema.TABLES
Select * from employee_information
```

## Oracle TNS 

The `Oracle Transparent Network Substrate` (`TNS`) server is a communication protocol that facilitates communication between Oracle databases and applications over networks.

Each database or service has a unique entry in the [tnsnames.ora](https://docs.oracle.com/cd/E11882_01/network.112/e10835/tnsnames.htm#NETRF007) file, containing the necessary information for clients to connect to the service. The entry consists of a name for the service, the network location of the service, and the database or service name that clients should use when connecting to the service

Nmap scan 
```shell-session
sudo nmap -p1521 -sV 10.129.204.235 --open
```

```shell-session
sudo nmap -p1521 -sV 10.129.204.235 --open --script oracle-sid-brute
``` 

Odat (open source oracle db tool) enumeration 
```shell-session
 ./odat.py all -s 10.129.204.235
``` 

SQLplus to login 
```shell-session
sqlplus scott/tiger@10.129.204.235/XE
```

sqlplus:error while loading shared libraries 
```shell-session
sudo sh -c "echo /usr/lib/oracle/12.2/client64/lib > /etc/ld.so.conf.d/oracle-instantclient.conf";sudo ldconfig
```
[SQLplus commands](https://docs.oracle.com/cd/E11882_01/server.112/e41085/sqlqraa001.htm#SQLQR985)

sqlplus database enumeration if DBA privileges 
```
sqlplus scott/tiger@<target-ip>/XE as sysdba
```

Dumping password hashes 
```
SELECT name, password FROM sys.user$;
```

File upload 
```
./odat.py utlfile -s <target-ip> -d XE -U scott -P tiger --sysdba --putFile C:\\inetpub\\wwwroot #Windows 

./odat.py utlfile -s <target-ip> -d XE -U scott -P tiger --sysdba --putFile /var/www/html/testing.txt #linux 

```
Verify file was uploaded 
```
curl -X GET http://<target-ip>/testing.txt
```


Lab for dumping password hash 
```
sudo nmap -p1521 -sV IP --open 
sudo nmap -p1521 -sV IP --open --script oracle-sid-brute
SID is XE 
odat all -s IP 

```